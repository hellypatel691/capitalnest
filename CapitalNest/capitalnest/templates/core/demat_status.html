{% comment %} <!DOCTYPE html>
<html>
<head>
  <title>Demat Status</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
<div class="container py-5">
<h3 class="mb-4">Demat Applications</h3>

<table class="table table-bordered">
<tr>
  <th>Name</th>
  <th>PAN</th>
  <th>Status</th>
</tr>

{% for app in applications %}
<tr>
  <td>{{ app.full_name }}</td>
  <td>{{ app.pan_number }}</td>
  <td>
    <span class="badge 
      {% if app.status == 'Approved' %}bg-success
      {% elif app.status == 'Rejected' %}bg-danger
      {% else %}bg-warning{% endif %}">
      {{ app.status }}
    </span>
  </td>
</tr>
{% endfor %}
</table>

</div>
</body>
</html> {% endcomment %}

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Demat Applications – Status Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root{
      --clr-approved:#198754;
      --clr-rejected:#dc3545;
      --clr-pending:#ffc107;
    }
    .status-approved   { background-color:var(--clr-approved); }
    .status-rejected   { background-color:var(--clr-rejected); }
    .status-pending    { background-color:var(--clr-pending); color:#212529; }

    /*  Mobile first: hide table, show cards */
    #card-view{ display:block; }
    #table-view{ display:none; }

    /*  ≥768 px : hide cards, show table */
    @media (min-width:768px){
      #card-view{ display:none; }
      #table-view{ display:table; }
    }

    .card-view .card{ margin-bottom:.75rem; }
    .sortable{ cursor:pointer; user-select:none; }
    .sortable:hover{ background:#f8f9fa; }
  </style>
</head>
<body class="bg-light">
<div class="container py-4">
  <div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
    <h1 class="h4 mb-0">Demat Applications</h1>
    <div class="mt-2 mt-md-0">
      <input id="searchBox" type="search" class="form-control form-control-sm" placeholder="Search by name or PAN…" aria-label="Search applications">
    </div>
  </div>

  <!--  EMPTY STATE  -->
  <div id="emptyState" class="alert alert-info d-none">
    No applications found.
  </div>

  <!--  CARD VIEW (mobile)  -->
  <div id="card-view" class="card-view"></div>

  <!--  TABLE VIEW (≥768 px)  -->
  <div class="table-responsive">
    <table id="table-view" class="table table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th scope="col" class="sortable" data-sort="name">Name&nbsp;<span class="small">↕</span></th>
          <th scope="col" class="sortable" data-sort="pan">PAN&nbsp;<span class="small">↕</span></th>
          <th scope="col" class="sortable" data-sort="status">Status&nbsp;<span class="small">↕</span></th>
          <th scope="col" aria-label="Actions"></th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <!-- rows injected by JS -->
      </tbody>
    </table>
  </div>
</div>

<script>
  /* ----------  MOCK DATA (replace with server payload)  ---------- */
  const applications = [
    {full_name:"Aarav Sharma",    pan_number:"ABCDE1234F", status:"Approved"},
    {full_name:"Priya Iyer",      pan_number:"XYZAB5678C", status:"Pending"},
    {full_name:"Rohit Desai",     pan_number:"LMNOP9012Q", status:"Rejected"},
    {full_name:"Sneha Reddy",     pan_number:"STUVW3456X", status:"Approved"}
  ];

  /* ----------  RENDER & INTERACTION  ---------- */
  const searchBox   = document.getElementById('searchBox');
  const cardView    = document.getElementById('card-view');
  const tableBody   = document.getElementById('tableBody');
  const emptyState  = document.getElementById('emptyState');

  let currentSort   = {key:null, dir:1};

  function badge(status){
    const cls = status.toLowerCase();
    return `<span class="badge status-${cls}">${status}</span>`;
  }

  function render(list){
    const query = searchBox.value.trim().toLowerCase();
    const filtered = list.filter(a =>
      a.full_name.toLowerCase().includes(query) ||
      a.pan_number.toLowerCase().includes(query)
    );

    /* cards */
    cardView.innerHTML = filtered.map(a=>`
      <div class="card shadow-sm">
        <div class="card-body d-flex justify-content-between align-items-center">
          <div>
            <div class="fw-bold">${a.full_name}</div>
            <div class="small text-muted">${a.pan_number}</div>
          </div>
          <div>${badge(a.status)}</div>
        </div>
      </div>`).join('');

    /* table */
    tableBody.innerHTML = filtered.map(a=>`
      <tr>
        <td>${a.full_name}</td>
        <td class="text-uppercase">${a.pan_number}</td>
        <td>${badge(a.status)}</td>
        <td><button class="btn btn-sm btn-outline-primary">View</button></td>
      </tr>`).join('');

    emptyState.classList.toggle('d-none', filtered.length>0);
  }

  function sortBy(key){
    currentSort.dir = (currentSort.key===key)? -currentSort.dir : 1;
    currentSort.key = key;
    applications.sort((a,b)=>{
      let va = a[key].toLowerCase(), vb = b[key].toLowerCase();
      return va>vb? currentSort.dir : -currentSort.dir;
    });
    render(applications);
  }

  /* ----------  EVENTS  ---------- */
  searchBox.addEventListener('input', ()=>render(applications));
  document.querySelectorAll('th.sortable').forEach(th=>{
    th.addEventListener('click',()=>sortBy(th.dataset.sort));
  });

  /* ----------  INITIAL PAINT  ---------- */
  render(applications);
</script>
</body>
</html>
